service: crudbox-backend

frameworkVersion: '3'

provider:
  name: aws
  runtime: provided.al2023
  region: ${env:AWS_REGION}
  stage: ${env:STAGE, 'prod'}
  architecture: x86_64
  logs:
    httpApi: true
  environment:
    DB_HOST: ${env:DB_HOST}
    DB_PORT: ${env:DB_PORT}
    DB_USER: ${env:DB_USER}
    DB_PASSWORD: ${env:DB_PASSWORD}
    DB_NAME: ${env:DB_NAME}
    DB_SSLMODE: ${env:DB_SSLMODE}
    JWT_SECRET: ${env:JWT_SECRET}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
          Resource:
            - arn:aws:logs:${env:AWS_REGION}:*:log-group:/aws/lambda/*:*

package:
  artifact: dist/function.zip

functions:
  api:
    name: crudbox-backend-${sls:stage}
    handler: bootstrap
    events:
      - httpApi: '*'
